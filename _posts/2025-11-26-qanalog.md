---
layout: post
title: "q-模拟和q-级数及其应用"
subtitle: "整数分拆, 雅可比三重积恒等式, 罗杰斯-拉马努金恒等式等"
author: "QED"
header-img: "img/post-bg-infinity.jpg"
header-mask: 0.3
math: true
tags:
  - 数论
---


# q-模拟基础

若无特殊说明, 以下内容均在形式幂级数环$\mathbb{C}[[q]]$中讨论, 仅在必要时对$q$取特定值并讨论其收敛性.

<div style="border: 3px solid #000; padding: 10px;">

<b>定义(q-整数)</b>

对于非负整数$n$, q-整数定义为:
$$
[n]_q = 1 + q + q^2 + \cdots + q^{n-1} = \frac{1 - q^n}{1 - q},
$$
特别地, $[0]_q = 0$. 当$q \to 1$时, $[n]_q \to n$, 即退化为普通整数.

</div><br>

<div style="border: 3px solid #000; padding: 10px;">

<b>定义(q-阶乘)</b>

对于非负整数$n$, q-阶乘定义为q-整数的乘积:
$$
[n]_q! = \prod_{k=1}^n [k]_q = [1]_q [2]_q \cdots [n]_q,
$$
其中约定$[0]_q! = 1$. 其等价表达式为:
$$
[n]_q! = \frac{(1 - q)(1 - q^2) \cdots (1 - q^n)}{(1 - q)^n},
$$
当$q \to 1$时, $[n]_q! \to n!$, 即退化为普通阶乘.

</div><br>

<div style="border: 3px solid #000; padding: 10px;">

<b>定义(q-波赫哈默符号)</b>

q-波赫哈默符号定义为: 对于复数$a$, 定义
$$
(a; q)_\infty = \prod_{k=0}^\infty (1 - a q^k)=(1-a)(1-aq)(1-aq^2)(1-aq^3)\cdots,
$$

对任意整数$n$, 定义
$$
(a; q)_n =\frac{(a; q)_\infty}{(aq^n; q)_\infty},
$$

显然, 当$n=0$时, $(a; q)_0 = 1$, 当$n$为正整数时, 有
$$
(a; q)_n = \prod_{k=0}^{n-1} (1 - a q^k)=(1-a)(1-aq)(1-aq^2)\cdots(1-aq^{n-1}),
$$

$$
(a; q)_{-n} = \frac{1}{(aq^{-n}; q)_n} = \prod_{k=1}^{n}\frac{1}{1 - a q^{-k}}.
$$
</div>

注: 当$a=q$时, 有记法$\phi(q)=(q;q)_\infty$, 称为欧拉函数. 在不引起混淆的情况下, 有如下简记法: $(a)_n=(a;q)_n$, $(a)_\infty=(a;q)_\infty$, $(a,b;q)_n=(a;q)_n(b;q)_n$, $(a,b;q)_\infty=(a;q)_\infty(b;q)_\infty$, 更多元的情况类似. 使用q-波赫哈默符号, 就有:
$$
[n]_q!=\frac{(q;q)_n}{(1-q)^n}.
$$


<div style="border: 3px solid #000; padding: 10px;">

<b>定义(q-二项式系数)</b>

对于整数$0 \leq k \leq n$, q-二项式系数定义为:
$$
\binom{n}{k}_q = \frac{[n]_q!}{[k]_q! \, [n - k]_q!},
$$
当$k > n$或$k < 0$时, 约定$\binom{n}{k}_q = 0$. 等价的, 有
$$
\binom{n}{k}_q = \frac{(1 - q^n)(1 - q^{n-1}) \cdots (1 - q^{n - k + 1})}{(1 - q^k)(1 - q^{k - 1}) \cdots (1 - q)},
$$
当$q \to 1$时, $\binom{n}{k}_q \to \binom{n}{k}$.

</div>

一个有趣的组合事实是, 当$q$取素数的幂时, $q$阶有限域$\mathbb{F}_q$上的$n$维向量空间$\mathbb{F}_q^n$中, $k$维子空间的个数恰好就是$\binom{n}{k}_q$, 也就是说格拉斯曼簇$\mathrm{Gr}(k,\mathbb{F}_q^n)$的元素个数即为$\binom{n}{k}_q$.

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(q-杨辉恒等式)</b>

$$
\binom{n}{k}_q=q^k\binom{n-1}{k}_q+\binom{n-1}{k-1}_q,
$$
$$
\binom{n}{k}_q=\binom{n-1}{k}_q+q^{n-k}\binom{n-1}{k-1}_q.
$$
</div>

<div style="border: 3px solid #000; padding: 10px;">

<b>证明:</b>

直接按定义验证即可.

</div><br>

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(q-二项式定理)</b>

对于非负整数$n$, 有:
$$
\prod_{k=0}^{n-1} (1 + q^k x) = \sum_{k=0}^n \binom{n}{k}_q q^{\frac{k(k-1)}{2}} x^k
$$
当$q \to 1$时, 退化为普通二项式定理$(1 + x)^n = \sum_{k=0}^n \binom{n}{k} x^k$, 对于负数情况, 有:
$$
\prod_{k=0}^{n-1}\frac{1}{1 - q^k x}= \sum_{k=0}^\infty \binom{n+k-1}{k}_q x^k,
$$
当$q \to 1$时, 即为$(1 - x)^{-n} = \sum_{k=0}^\infty \binom{n+k-1}{k} x^k$.
</div>

<div style="border: 3px solid #000; padding: 10px;">

<b>证明:</b>

由归纳法和q-杨辉恒等式即可证明, 但我们这里使用另一种方法证明第一个式子, 这种方法在q-级数理论中十分常用, 第二个式子也可以类似证明.

定义$K_n(x)$为
$$
K_n(x) = \prod_{k=0}^{n-1} (1 + q^k x) = \sum_{k=0}^n c_k x^k
$$
其中$c_k$为展开式中$x^k$的系数, 显然有
$$
(1+q^nx)K_n(x)=(1+x)K_n(qx),
$$
代入幂级数并比较系数得递推公式
$$
c_k+q^nc_{k-1}=q^kc_k+q^{k-1}c_{k-1},
$$
即$(1-q^k)c_k=(q^{k-1}-q^n)c_{k-1}$, 因$c_0=1$, 故$c_1=\frac{1-q^n}{1-q}=\binom{n}{1}$, 若$c_{k-1}=\binom{n}{k-1} q^{\frac{(k-1)(k-2)}{2}}$, 则$c_k=\frac{q^{k-1}-q^n}{1-q^k}\binom{n}{k-1} q^{\frac{(k-1)(k-2)}{2}}=\binom{n}{k}q^{k-1}q^{\frac{(k-1)(k-2)}{2}}=\binom{n}{k}q^{\frac{k(k-1)}{2}}$, 由归纳法知定理成立.

</div>

# q-分析学

<div style="border: 3px solid #000; padding: 10px;">

<b>定义(q-导数)</b>

设$f$是一个实函数, 则定义其q-导数为

$$
D_qf(x)=\frac{f(x)-f(qx)}{x-qx},
$$

当$f$可导时, 令$q\to 1$有$\lim_{q\to1}D_qf(x)=f'(x)$.
</div>

可做一些简单的计算, 设$f(x)=x^a$, 这里$a$是任意实数, 则有

$$
D_qx^a=\frac{x^a-(qx)^{a}}{x-qx}=\frac{1-q^a}{1-q}x^{a-1}=[a]_qx^{a-1},
$$

其中$[a]_q$形式地定义为$\frac{1-q^a}{1-q}$.

显然q-导数是线性的, 即$D_q(f+g)=D_qf+D_qg$, $D_q(kf)=kD_qf$, 并且有q-莱布尼兹律

$$
D_q^n(f(x)g(x))=\sum_{k=0}^n\binom{n}{k}_q\left(D_q^{n-k}f(q^kx)\right)\left(D_q^kg(x)\right),
$$

该公式由归纳法即可证明, 当$g\neq 0$时, 对$\frac{f}{g}$亦有对应求导公式.

一个自然的想法是寻找一个在q-导数下不变的函数, 即q-指数函数, 定义为:

$$
\exp_q(x)=\sum_{k=0}^\infty\frac{x^k}{[k]_q!},
$$

则有$D_q\exp_q(x)=\exp_q(x)$, 且$\lim\limits_{q\to1}\exp_q(x)=e^x$. 实际这里定义域可以取到复数, 其中要求$\lvert q\rvert<1$, 我们以后用$z$表示复数.

由此我们可以定义q-三角函数

$$
\sin_q (z)=\frac{\exp_q(iz)-\exp_q(-iz)}{2i},\cos_q (z)=\frac{\exp_q(iz)+\exp_q(-iz)}{2},
$$

当$q$趋于1时即为通常的三角函数.

接下来定义q-积分.

<div style="border: 3px solid #000; padding: 10px;">

<b>定义(q-积分)</b>

设$f$在积分域上有定义, $a,b\in\mathbb{R}$, 则q-积分定义为：

$$
\int_0^a f(x) \mathrm{d}_q x = a(1 - q) \sum_{n=0}^\infty f(a q^n) q^n,
$$

$$
\int_0^\infty f(x)\mathrm{d}_q x = (1 - q) \sum_{n=-\infty}^\infty f(q^n) q^n,
$$

$$
\int_b^a f(x) \mathrm{d}_q x =\int_0^a f(x) \mathrm{d}_q x -\int_0^b f(x) \mathrm{d}_q x,
$$

各无界区间的积分类似定义, 若$f$在积分域内可积, 则当$q\to1$时即为通常的积分.
</div>

q-积分的线性性是显然的, 接下来证明q-微积分基本定理.

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(q-微积分基本定理)</b>

当$0<q<1$时, 有

$$
D_q\left(\int_0^xf(t)\mathrm{d}_q t\right)=f(x),
$$

$$
\int_0^xD_qf(t)\mathrm{d}t=f(x)-f(0).
$$
</div>

<div style="border: 3px solid #000; padding: 10px;">

<b>证明:</b>

由

$$
\displaylines{D_q\left(\int_0^xf(t)\mathrm{d}_q t\right)=\frac{\int_0^xf(t)\mathrm{d}_qt-\int_0^{qx}f(t)\mathrm{d}_qt}{x-qx}\\
=\sum_{n=0}^\infty f(x q^n) q^n-\sum_{n=0}^\infty f(x q^{n+1}) q^{n+1}=f(x),}
$$

和

$$
\displaylines{\int_0^xD_qf(t)\mathrm{d}t=x(1 - q) \sum_{n=0}^\infty \frac{f(xq^n)-f(xq^{n+1})}{xq^n-xq^{n+1}} q^n\\
=\sum_{n=0}^\infty \left(f(xq^n)-f(xq^{n+1})\right)=f(x)-f(0),}
$$

即可得证.
</div>

如果记$D_q(g(t))\mathrm{d}_qt$为$\mathrm{d}_qg(t)$, 则有q-黎曼斯蒂尔杰斯积分或q-换元法.

$$
\int_0^xf(t)\mathrm{d}g(t)=\sum_{n=0}^\infty f(xq^n)\left(g(xq^n)-g(xq^{n+1})\right).
$$

q-微积分在q-特殊函数论中有重要的应用, 下面介绍一些重要的q-特殊函数.

<div style="border: 3px solid #000; padding: 10px;">

<b>定义(q-伽马函数)</b>

当$|q|<1$时, 定义

$$
\Gamma_q(x) =(1 - q)^{1 - x} \frac{(q;q)_\infty}{(q^x;q)_\infty}.
$$
</div>

显然有$\Gamma_q(x+1)=[x]_q\Gamma_q(x)$, 并且当$n$是正整数时, $\Gamma_q(n)=[n-1]_q!$, 可以证明$\lim_{q\to1}\Gamma_q(x)=\Gamma(x)$.

<div style="border: 3px solid #000; padding: 10px;">

<b>定义(q-贝塔函数)</b>

当$|q|<1$时, 定义

$$
B_q(x,y) = \frac{\Gamma_q(x)\Gamma_q(y)}{\Gamma_q(x+y)}.
$$
</div>

我们知道广义超几何函数定义为

$$
_rF_s(a_1,\dots,a_r;b_1,\dots,b_s;z)= _rF_s\left[
\begin{matrix}a_1 \ldots a_r\\b_1 \ldots b_s\end{matrix};z\right]= \sum_{n=0}^\infty\frac{(a_1)_n\cdots(a_r)_n}{(b_1)_n\cdots(b_s)_n}\frac{z^n}{n!},
$$

其中$(a)_n=\frac{\Gamma(a+n)}{\Gamma(a))}=a(a+1)\cdots(a+n-1)$为上升阶乘, 当$r=2$, $s=1$时, $_2F_1$即为超几何函数, 广义超几何函数在特殊函数论中十分重要, 它的q-模拟称为q-超几何函数或基本超几何函数:

$$
\displaylines{_r\phi_s(a_1,\dots,a_r;b_1,\dots,b_s;q,z)=\ _r\phi_s\left[
 \begin{matrix}
  a_1 \ldots a_r\\
  b_1 \ldots b_s
 \end{matrix}
;q,z\right]\\
=\sum_{n=0}^\infty\frac{(a_1,\dots,a_r;q)_n}{(b_1,\dots,b_s;q)_n}\frac{z^n}{(q,q)_n}\left((-1)^nq^{\frac{n(n-1)}{2}}\right)^{1+s-r},}
$$

有

$$
\displaylines{\lim_{q\to1}\ _r\phi_s\left[
 \begin{matrix}
  q^{a_1} \ldots q^{a_r}\\
  q^{b_1} \ldots q^{b_s}
 \end{matrix}
;q,\left(1-q\right)^{1+s-r}z\right]=\ _rF_s\left[
 \begin{matrix}
  a_1 \ldots a_r\\
  b_1 \ldots b_s
 \end{matrix}
;z\right],}
$$

此外还有双边求和情形, 用$\psi$表示:

$$
\displaylines{_r\psi_s(a_1,\dots,a_r;b_1,\dots,b_s;q,z)=\ _r\psi_s\left[
 \begin{matrix}
  a_1 \ldots a_r\\
  b_1 \ldots b_s
 \end{matrix}
;q,z\right]\\
=\sum_{n=-\infty}^\infty\frac{(a_1,\dots,a_r;q)_n}{(b_1,\dots,b_s;q)_n}z^n\left((-1)^nq^{\frac{n(n-1)}{2}}\right)^{s-r},}
$$

其中$r=s=1$时称为拉马努金$_1\psi_1$求和.

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(拉马努金$_1\psi_1$求和公式)</b>

设$a,b,z$是复数, 当$\left|\frac{b}{a}\right|<|z|<1$时有

$$
_1\psi_1(a;b;q,z)=\frac{\left(q,\frac{b}{a},az,\frac{q}{az};q\right)_\infty}{\left(b,\frac{q}{a},z,\frac{b}{az};q\right)_\infty}.
$$
</div>

证明见[1]的定理1.3.12.


# 加性数论

## 加性数论基础

加性数论研究整数的分拆, 该领域最基本的定理由欧拉给出, 设$n$是一个正整数, 定义$p(n)$为将$n$分拆为任意多个可重复正整数的和$($不计顺序$)$的方法数, 则有:

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(欧拉定理)</b>

$$
\frac{1}{(x,x)_\infty}=\frac{1}{(1-x)(1-x^2)(1-x^3)\cdots}=1+\sum_{n=1}^\infty p(n)x^n.
$$
</div>

<div style="border: 3px solid #000; padding: 10px;">

<b>证明:</b>

左边展开为无穷级数就是乘积
$$(1+x+x^2+\cdots)(1+x^2+x^3+\cdots)(1+x^3+x^6+\cdots)\cdots$$
由无穷级数的乘法可知, $n$的每种分拆法都对应$x^n$的系数中的一个$1$, 故$x^n$的系数就是$p(n)$, 严格的证明此处省略.
</div>

类似的方法可以得到更多分拆类型的生成函数, 例如函数

$$
\frac{1}{(1-x)(1-x^3)(1-x^5)\cdots}
$$

就是将$n$分拆为正奇数之和的方法数的生成函数,

$$
\frac{1}{(1-x^2)(1-x^4)(1-x^6)\cdots}
$$

就是将$n$分拆为正偶数之和的方法数的生成函数,

$$
(1+x)(1+x^2)(1+x^3)\cdots
$$

是将$n$分拆为不相等的正整数之和的方法数的生成函数.

由生成函数之间的简单代数关系可以迅速推出一些复杂的数论定理, 例如

$$
(1+x)(1+x^2)\cdots=\frac{1-x^2}{1-x}\frac{1-x^4}{1-x^2}\cdots=\frac{1}{(1-x)(1-x^3)\cdots}
$$

$$
\Longleftrightarrow (-x,x)_\infty=\frac{1}{(x,x^2)_\infty}
$$

暗示将$n$分拆为不相等的正整数之和的方法数与将$n$分拆为正奇数之和的方法数相等, 而使用其他方法证明这件事远比生成函数复杂的多.

## 雅可比三重积恒等式

首先定义雅可比theta函数.

<div style="border: 3px solid #000; padding: 10px;">

<b>定义(雅可比theta函数)</b>

设$z$是复数, $\tau$是上半复平面中的点, 则定义雅可比theta函数为

$$
\theta(z,\tau)=\sum_{n=-\infty}^\infty e^{\pi in^2\tau}e^{2\pi iz},
$$

习惯上做代换$q= e^{\pi i\tau}$和$\eta = e^{2\pi iz}$得到

$$
\theta(\eta,q)=\sum_{n=-\infty}^{\infty}q^{n^2}\eta^n,
$$

这里我们滥用了符号, 其中, $\eta=e^{2\pi iz}\neq 0$, 若设$\tau=a+bi$, $b>0$, 则$|q|=|e^{\pi i(a+bi)}|=e^{-\pi b}<1$.
</div>

与之相关的函数是拉马努金theta函数, 但习惯上一般用$f$表示.

<div style="border: 3px solid #000; padding: 10px;">

<b>定义(拉马努金theta函数)</b>

设$a,b\in\mathbb{C}$且$|ab|<1$, 定义拉马努金theta函数为

$$
f(a,b)=\sum_{n=-\infty}^\infty a^{\frac{n(n+1)}{2}}b^{\frac{n(n-1)}{2}},
$$
</div>

它有一些特殊情况, 例如拉马努金$\varphi$函数

$$
\varphi(q)=f(q,q)=\sum_{n=-\infty}^\infty q^{n^2}=\theta(1,q),
$$

拉马努金$\psi$函数

$$
\psi(q)=f(q,q^3)=\sum_{n=0}^\infty q^{\frac{n(n+1)}{2}},
$$

前文中定义的欧拉函数也是其特例, 这由后文即将证明的欧拉五边形数公式保证,

$$
\phi(q)=(q;q)_\infty=f(-q,-q^2).
$$

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(雅可比三重积恒等式)</b>

设复数$|q|<1$, $\eta\neq0$, 则有

$$
\prod_{n=1}^\infty(1-q^{2n})(1+q^{2n-1}\eta)(1+q^{2n-1}\eta^{-1})=\sum_{n=-\infty}^\infty q^{n^2}\eta^n,
$$

等价的写法是

$$
\theta(q,\eta)=(q^2;q^2)_\infty(-q\eta;q^2)_\infty(-q\eta^{-1};q^2)_\infty=(q^2,-q\eta,-q\eta^{-1};q^2)_\infty.
$$
</div>

该定理的证明有多种方法, 例如[6]的第19.8节, 它也可以由拉马努金$_1\psi_1$求和公式推出.

一些简单的特例是取$\eta=\pm1$, 有

$$
\varphi(q)=\sum_{n=-\infty}^\infty q^{n^2}=\prod_{n=1}^\infty(1-q^{2n})(1+q^{2n-1})^2,
$$

$$
\sum_{n=-\infty}^\infty (-1)^n q^{n^2}=\prod_{n=1}^\infty(1-q^{2n})(1-q^{2n-1})^2.
$$

在雅可比三重积恒等式中作代换$q\mapsto q^{\frac{3}{2}}$, $\eta\mapsto -q^{\frac{1}{2}}$得

$$
\sum_{n=-\infty}^\infty (-1)^{n}q^{\frac{n(3n+1)}{2}}=(q^3,q^2,q;q^3)_\infty=(q;q)_\infty,
$$

第二个等号是因为

$$
\prod_{n=1}^\infty(1-q^{3n+3})(1-q^{3n+2})(1-q^{3n+1})=\prod_{n=1}^\infty (1-q^n),
$$

再用$-n$替换$n$得到

$$
(-1)^{-n}q^{\frac{-n(-3n+1)}{2}}=(-1)^nq^{\frac{n(3n-1)}{2}}.
$$

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(欧拉五边形数公式)</b>

当复数$|q|<1$时, 有恒等式

$$
\sum_{n=-\infty}^\infty (-1)^{n}q^{\frac{n(3n-1)}{2}}=(q;q)_\infty.
$$
</div>

该公式称为欧拉五边形数公式, 是因为诸$\frac{n(3n-1)}{2}$即为所谓的五边形数.

在雅可比三重积恒等式中作代换$q\mapsto q^{\frac{1}{2}}$, $\eta\mapsto q^{\frac{1}{2}}\zeta$, 其中$\zeta$是不等于$0$或$-1$的实数, 则得到

$$
\prod_{n=1}^\infty(1-q^{n})(1+q^{n}\zeta)(1+q^{n-1}\zeta^{-1})=\sum_{n=-\infty}^\infty q^{\frac{n^2+n}{2}}\zeta^n,
$$

等价于

$$
(1+\zeta^{-1})\prod_{n=1}^\infty(1-q^{n})(1+q^{n}\zeta)(1+q^{n}\zeta^{-1})=\sum_{n=1}^\infty q^{\frac{n^2+n}{2}}(\zeta^n+\zeta^{-n-1}),
$$

整理得到

$$
\prod_{n=1}^\infty(1-q^{n})(1+q^{n}\zeta)(1+q^{n}\zeta^{-1})=\sum_{n=1}^\infty q^{\frac{n^2+n}{2}}\zeta^{-n}\frac{1+\zeta^{2n+1}}{1+\zeta}=\sum_{n=1}^\infty q^{\frac{n^2+n}{2}}\zeta^{-n}(1-\zeta+\zeta^2-\cdots+\zeta^{2n}),
$$

该等式两边对于$\zeta=-1$均有定义, 并且在$-1$附近收敛, 故可取$\zeta\to-1$得到:

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(雅可比恒等式)</b>

当复数$|q|<1$时, 有

$$
(q;q)_\infty^3=\prod_{n=1}^\infty(1-q^{n})^3=\sum_{n=1}^\infty (-1)^n(2n+1)q^{\frac{n(n+1)}{2}}.
$$
</div>

另一个代换给出拉马努金theta函数的三重积恒等式, 设复数$a,b$均不为$0$且$|ab|<1$, 令$q=(ab)^{\frac{1}{2}}$, $\eta=a^\frac{1}{2}b^{-\frac{1}{2}}$, 则有

$$
(q^2,-q\eta,-q\eta^{-1};q^2)_\infty=(ab,-a,-b;ab)_\infty,
$$

$$
\sum_{n=-\infty}^\infty q^{n^2}\eta^n=\sum_{n=-\infty}^\infty a^{\frac{n^2}{2}}b^{\frac{n^2}{2}}a^{\frac{n}{2}}b^{-\frac{n}{2}}=\sum_{n=-\infty}^\infty a^{\frac{n(n+1)}{2}}b^{\frac{n(n-1)}{2}},
$$

当$a,b$可以取$0$时约定$0^0=1$即得:

$$
f(a,b)=(ab,-a,-b;ab)_\infty.
$$

由雅可比三重积恒等式可以推出许多重要的数论定理, 现举几例.

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(二平方和定理)</b>

定义$r_2(n)$为将正整数$n$表示为两个整数$($计正负, 计顺序$)$的平方和的方法数, 并定义$d_1(n)$表示$n$的模$4$同余于$1$的正因数个数, 即

$$
d_1(n)=\sum_{\substack{a|n,\\a\equiv1\mod{4}}}1,
$$

同理定义$d_3(n)$表示$n$的模$4$同余于$3$的正因数个数, 则有

$$
r_2(n)=4(d_1(n)-d_3(n)).
$$
</div>

举一个例子, $5=1^2+2^2=(-1)^2+2^2=1^2+(-2)^2=(-1)^2+(-2)^2=2^2+1^1=2^2+(-1)^2=(-2)^2+1^2=(-2)^2+(-1)^2$, 故$r_2(5)=8=4(2-0)$.

当取$n$为奇素数$p$时, 立刻得到费马二平方和定理: 如果$p\equiv1\mod 4$, 则$d_1(p)=2$, 即$p$有两个模$4$同余于$1$的正因数, 分别是$1$和$p$自身, 而无模$4$同余于$3$的正因数, 故$r_2(p)=8>0$, 如果$p\equiv3\mod 4$, 则$d_1(p)=d_3(p)=1$, 即$p$有一个模$4$同余于$1$的正因数, 即$1$, 有一个模$4$同余于$3$的正因数, 即$p$自身, 故$r_2(p)=0$.

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(四平方和定理)</b>

定义$r_4(n)$为将正整数$n$表示为四个整数$($计正负, 计顺序$)$的平方和的方法数, 则

$$
r_4(n)=8\sum_{\substack{a\mid n\\4 \nmid a}}a.
$$
</div>

由此立刻得到拉格朗日四平方和定理, 因为对任何正整数$n$, $1$都一定是其因子并且不能被$4$整除, 故$r_4(n)\ge8>0$.

<div style="border: 3px solid #000; padding: 10px;">

<b>定理(二三角形数和定理,四三角形数和定理)</b>

首先定义三角形数为形如$\frac{k(k+1)}{2}$的数, 其中$k$是非负整数, 定义$t_2(n)$为将正整数$n$表示为两个三角形数$($计顺序$)$的和的方法数, $t_4(n)$为将正整数$n$表示为四个三角形数$($计顺序$)$的和的方法数, 则有

$$
t_2(n)=d_1(4n+1)-d_3(4n+1),
$$

$$
t_4(n)=\sigma(2n+1)=\sum_{a\mid 2n+1}a.
$$
</div>

例如, 因为$3=3+0=0+3$, 故$t_2(3)=2=2-0$, 因为$3=1+1+1+0=1+1+0+1=1+0+1+1=0+1+1+1=3+0+0+0=0+3+0+0=0+0+3+0=0+0+0+3$, 故$t_4(3)=8=1+7$. 显然有$t_4(n)\ge2n+2\ge4>0$对任意正整数都成立, 而$t_2(n)$则未必不等于$0$, 例如$t_2(5)=2-2=0$, 但高斯三角形数定理表明, 对任意正整数一定有$t_3(n)>0$, 即任意正整数都可以表示为三个三角形数的和.

我们定义$r_k(n)$为将正整数$n$表示为$k$个整数$($计正负, 计顺序$)$的平方和的方法数, $t_k(n)$为将正整数$n$表示为$k$个三角形数$($计顺序$)$的和的方法数, 约定$r_k(0)=1$, $t_k(0)=1$, 则它们的生成函数是

$$
\sum_{n=0}^\infty r_k(n)q^n=\left(\sum_{n=-\infty}^\infty q^{n^2}\right)^k=\left(\varphi(q)\right)^k,
$$

$$
\sum_{n=0}^\infty t_k(n)q^n=\left(\sum_{n=0}^\infty q^{\frac{n(n+1)}{2}}\right)^k=\left(\psi(q)\right)^k.
$$

接下来考虑兰伯特级数

$$
\sum_{n=1}^\infty\frac{q^n}{1-q^n},
$$

将它展开为幂级数,

$$
\sum_{n=1}^\infty\frac{q^n}{1-q^n}=\sum_{n=1}^\infty\left(q^n+q^{2n}+q^{3n}+\cdots\right)=\sum_{n=1}^\infty d(n)q^n,
$$

其中$d(n)$显然是$n$的正因子个数, 类似的, 设$a$是正整数, $b$是非负整数, 展开

$$
\sum_{n=0}^\infty\frac{q^{an+b}}{1-q^{an+b}}=\sum_{n=0}^\infty\left(q^{an+b}+q^{2(an+b)}+q^{3(an+b)}+\cdots\right)=\sum_{n=0}^\infty d_{a,b}(n)q^n,
$$

其中$d_{a,b}(n)$表示的是$n$的模$a$同余于$b$的正因数个数, 因为上述求和中每个满足$m(ak+b)=n$的数$m(ak+b)$提供一个$1$, 而$ak+b$就是一个$n$的模$a$同余于$b$的正因数.

设$a(n)$是算术函数, 则有

$$
\sum_{n=1}^\infty\frac{a(n)q^{n}}{1-q^{n}}=\sum_{n=1}^\infty\left(a(n)q^{n}+a(n)q^{2n}+a(n)q^{3n}+\cdots\right)=\sum_{n=1}^\infty b(n)q^n,
$$

其中$b(n)=\sum_{k|n}a(k)$, 故

$$
\sum_{n=1}^\infty\frac{nq^{n}}{1-q^{n}}=\sum_{n=1}^\infty \sigma(n)q^n.
$$

因此, 之前的三个定理就等价于以下四个等式:

$$
\left(\sum_{n=-\infty}^\infty q^{n^2}\right)^2=1+4\sum_{n=0}^\infty\left(\frac{q^{4n+1}}{1-q^{4n+1}}-\frac{q^{4n+3}}{1-q^{4n+3}}\right),
$$

$$
\left(\sum_{n=-\infty}^\infty q^{n^2}\right)^4=1+8\sum_{n=1}^\infty\left(\frac{nq^{n}}{1-q^{n}}-\frac{4nq^{4n}}{1-q^{4n}}\right),
$$

$$
8q\left(\psi(q^4)\right)^2=(\varphi(q))^2-(\varphi(-q))^2,
$$

$$
16q\left(\psi(q^2)\right)^4=(\varphi(q))^4-(\varphi(-q))^4,
$$

其中后两式与原命题的等价性依赖于前两式, 因为

$$
8q\left(\psi(q^4)\right)^2=8\sum_{n=0}^\infty t_2(n)q^{4n+1},
$$

$$
(\varphi(q))^2-(\varphi(-q))^2=\sum_{n=0}^\infty r_2(n)q^n-\sum_{n=0}^\infty r_2(n)(-q)^n=4\sum_{n=0}^\infty (d_1(n)-d_3(n))(q^n-(-q)^n),
$$

故有

$$
8q\left(\psi(q^4)\right)^2=(\varphi(q))^2-(\varphi(-q))^2\Longleftrightarrow\sum_{n=0}^\infty t_2(n)q^{4n+1}=\frac{1}{2}\sum_{n=0}^\infty \left(d_1(n)-d_3(n)\right)\left(q^n-(-q)^n\right),
$$

其中等式右边, 当$n$是偶数时, $q^n-(-q)^n=0$, 当$n$形如$4k+3$时, $d_1(n)-d_3(n)=0$, 因为如果$a$是$n$的形如$4k+1$的因数, 那么$\frac{n}{a}$必然形如$4k+3$, 即$n$的因数中模$4$同余于$1$和模$4$同余于$3$的个数相同, 因此上式右边只有$q^{4n+1}$项, 比较系数即得$t_2(n)=d_1(4n+1)-d_3(4n+1)$.

类似的, 因为

$$
16q\left(\psi(q^2)\right)^4=16\sum_{n=0}^\infty t_4(n)q^{2n+1},
$$

$$
(\varphi(q))^4-(\varphi(-q))^4=\sum_{n=0}^\infty r_4(n)q^n-\sum_{n=0}^\infty r_4(n)(-q)^n=8\sum_{n=0}^\infty \left(\sum_{\substack{a\mid n\\4 \nmid a}}a\right)\left(q^n-(-q)^n\right),
$$

故有

$$
16q\left(\psi(q^2)\right)^4=(\varphi(q))^4-(\varphi(-q))^4\Longleftrightarrow\sum_{n=0}^\infty t_4(n)q^{2n+1}=\frac{1}{2}\sum_{n=0}^\infty \left(\sum_{\substack{a\mid n\\4 \nmid a}}a\right)\left(q^n-(-q)^n\right),
$$

当$n$是偶数时, $q^n-(-q)^n=0$, 所以等式右边只有奇数次项, 比较系数即得$t_4(n)=\sum\limits_{\substack{a\mid 2n+1\\4 \nmid a}}a$, 因为奇数的因数一定不是$4$的倍数, 故$4\nmid a$条件多余, 即有$t_4(n)=\sum_{\substack{a\mid 2n+1}}a=\sigma(2n+1)$.

这些公式均可由雅可比三重积恒等式和拉马努金$_1\psi_1$求和公式及一些恒等变换得到, 我们仅以第一式为例做具体证明.

<div style="border: 3px solid #000; padding: 10px;">

<b>证明:(二平方和定理的证明)</b>

在雅可比三重积恒等式中令$\eta=1$得到

$$
\varphi(q)=(q^2;q^2)_\infty(-q;q^2)^2_\infty,
$$

由拉马努金$_1\psi_1$求和公式得

$$
_1\psi_1(-1;-q^2;q^2,q)=\frac{(q^2,q^2,-q,-q;q^2)_\infty}{(-q^2,-q^2,q,q;q^2)_\infty}=\frac{(q^2;q^2)^2_\infty(-q;q^2)^2_\infty(-q;q)^2_\infty}{(-q^2;q^2)^2_\infty}=(q^2;q^2)^2_\infty(-q;q^2)^4_\infty,
$$

$$
_1\psi_1(-1;-q^2;q^2,q)=\sum_{n=-\infty}^\infty\frac{(-1;q^2)_n q^n}{(-q^2;q^2)_n}=\sum_{n=-\infty}^\infty\frac{2q^n}{1+q^{2n}}=1+4\sum_{n=1}^\infty\frac{q^n}{1+q^{2n}},
$$

故

$$
1+4\sum_{n=1}^\infty\frac{q^n}{1+q^{2n}}=(q^2;q^2)^2_\infty(-q;q^2)^4_\infty=\left(\varphi(q)\right)^2.
$$

左边展开为幂级数并交换求和顺序得

$$
\sum_{n=1}^\infty\frac{q^n}{1+q^{2n}}=\sum_{n=1}^\infty q^n\sum_{k=0}^\infty(-1)^{k}q^{2nk}=\sum_{k=0}^\infty(-1)^k\sum_{n=1}^\infty q^{n(2k+1)}=\sum_{k=0}^\infty\frac{(-1)^kq^{2k+1}}{1-q^{2k+1}},
$$

分奇偶求和, 得到

$$
\left(\varphi(q)\right)^2=1+4\sum_{k=0}^\infty\frac{(-1)^kq^{2k+1}}{1-q^{2k+1}}=1+4\sum_{n=0}^\infty\left(\frac{q^{4n+1}}{1-q^{4n+1}}-\frac{q^{4n+3}}{1-q^{4n+3}}\right),
$$

这等价于原定理.
</div>
